#!/usr/bin/python2
import json
import os.path
import sys
import time
import websocket
import pprint


websocket.enableTrace(True)
ws = websocket.WebSocket()
ws.connect("ws://localhost:8080/pubsub/pub/33")


CONF_PATH = "/var/run/itseml/"

def send_map(envname):
    interval = 1000
    with open(os.path.join(CONF_PATH, envname, 'map.json'), 'r') as f:
        map_mesg = json.load(f)

    try:
        interval =  map_mesg['map']['interval']
        del map_mesg['map']['interval']
    except KeyError as e:
        pass

    map_json = json.dumps(map_mesg)

    while True:
        ws.send(map_json)
        time.sleep(float(interval)/1000.0)

if __name__ == '__main__':
    send_map(sys.argv[1])
